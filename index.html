<!DOCTYPE html>
<html>
<head>
  <title>Max the Mojo Magician</title>
  <style>
    body { margin: 0; font-family: sans-serif; display: flex; height: 100vh; }
    #chat { width: 40%; border-right: 1px solid #ccc; }
    #results { width: 60%; padding: 1rem; overflow-y: auto; }
    iframe { width: 100%; height: 100%; border: none; }
    .result { border: 1px solid #ddd; margin-bottom: 1rem; padding: 1rem; border-radius: 8px; }
  </style>
</head>
<body>

  <!-- LEFT SIDE: Chatbot -->
  <div id="chat">
    <!-- Chatbot iframe will be injected via JS with sessionId -->
  </div>

  <!-- RIGHT SIDE: Dynamic Search Results -->
  <div id="results">
    <h1>Results for: <span id="search-term"></span></h1>
  </div>

  <!-- Firebase + Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    // ✅ Your Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyDQpTZ_nnViWEEfPIz1I1GgTbQu3i5pQMM",
      authDomain: "mojo-chat-sync-test.firebaseapp.com",
      databaseURL: "https://mojo-chat-sync-test-default-rtdb.firebaseio.com",
      projectId: "mojo-chat-sync-test",
      storageBucket: "mojo-chat-sync-test.appspot.com",
      messagingSenderId: "322619127041",
      appId: "1:322619127041:web:ea086e1982cc37f03b9700"
    };

    // ✅ Init Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // ✅ Get or create session ID
    let sessionId = localStorage.getItem("mojoSessionId");
    if (!sessionId) {
      sessionId = crypto.randomUUID();
      localStorage.setItem("mojoSessionId", sessionId);
    }

    // ✅ Inject Max’s iframe with session ID
   document.getElementById("chat").innerHTML = `
  <iframe id="chat" style="width:100%; height:500px;"></iframe>
<script>
  document.getElementById("chat").innerHTML = `
    <iframe src="https://app.chatgptbuilder.io/webchat/plugin.js?v=6" style="width:100%; height:500px;"></iframe>
    <script>
      ktt10.setup({
        id: "h201F03x4e4lBQI0",
        accountId: "1349554",
        color: "#710725"
      });
    <\/script>
  `;
</script>
`;


    // ✅ Listen for search term updates on this session
    const sessionRef = ref(db, `sessions/${sessionId}`);
    onValue(sessionRef, snapshot => {
      const data = snapshot.val();
      if (data?.searchTerm) {
        showSearchResults(data.searchTerm);
      }
    });

    // ✅ Simulate Max writing to Firebase (for testing)
    window.simulateSearch = function () {
      const testTerm = prompt("Enter a search term to simulate:", "hell island");
      if (testTerm) {
        set(ref(db, `sessions/${sessionId}`), { searchTerm: testTerm });
      }
    };

    // ✅ Show matching results
    function showSearchResults(term) {
      document.getElementById("search-term").textContent = term;
      fetch('./results.json')
        .then(res => res.json())
        .then(data => {
          const matches = data.filter(row => row.term.toLowerCase().includes(term.toLowerCase()));
          const container = document.getElementById("results");
          container.innerHTML = '';
          matches.forEach(item => {
            const div = document.createElement("div");
            div.className = "result";
            div.innerHTML = `
              <div><strong>${item.course}</strong> – ${item.module}</div>
              <div>Timestamp: ${item.timestamp}</div>
              <a href="${item.link}" target="_blank">Go to Lesson</a>
            `;
            container.appendChild(div);
          });
        });
    }
  </script>

  <!-- Floating button to trigger test write -->
  <button onclick="simulateSearch()" style="position:fixed; bottom:10px; right:10px; z-index:999;">
    Test Firebase Write
  </button>

</body>
</html>

